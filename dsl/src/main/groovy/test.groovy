/***********************************************************************************************
*
* Copyright 2018 Infosys Ltd.
* Use of this source code is governed by MIT license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
*
***********************************************************************************************/

import groovy.json.JsonSlurper;
import com.infy.idp.plugins.buildsteps.*
import com.infy.idp.plugins.publishers.*
import com.infy.idp.plugins.wrappers.*
import com.infy.idp.utils.fs.*
import com.infy.idp.customtools.*
import com.infy.idp.utils.*
import org.infy.idp.entities.jobs.IDPJob;

PropReader.dirPath = (new File(__FILE__)).getAbsolutePath().substring(0,(new File(__FILE__)).getAbsolutePath().lastIndexOf(File.separator));

job("abcdefgh_1"){
  String jsonData = $/{                "basicInfo":                                {"additionalMailRecipients":{"applicationTeam":"","emailIds":""},                                "applicationName":"TinyJSON",                                "buildInterval":{"buildInterval":"","buildIntervalValue":0,"pollSCM":""},                                "buildServerOS":"linux",                                "engine":"NativeJenkinsWorkflow",                                "pipelineName":"test_scenario_1_try1"                                },                "code":                {                "category":"Standard",                "technology":"J2EE/Ant",                "scm":                                [                                                {"type":"svn","url":"http://dummyuser/svn","userName":"username1","password":"password1"}                                ]                },                "buildInfo":                {                                "buildtool":"J2EE/Ant",                                "castAnalysis":{},                                "artifactToStage":{},                                "modules":                                                [                                                                {"moduleName":"mod1",                                                                "relativePath":"/src",                                                                "codeAnalysis":[null,"pmd"],                                                                "unitTesting":"on",                                                                "codeCoverage":"on",                                                                "securityAnalysis":{"paffFilePath":"mod1.paf","serverMachine":"localhost"}                                                                }                                                ]                },                "deployInfo":                {              "deployEnv":                                [                                                {"envName":"string",                                                "envFlag":"on",                                                "deploySteps":                                                                [                                                                                {"runScript":{},                                                                                "deployToContainer":                                                                                                {"containerName":"jBoss",                                                                                                "resourceToBeDeployed":"manualJBoss",                                                                                                "serverManagerURL":"http://localhost:8080",                                                                                                "wARPath":"/target/test.war",                                                                                                "contextPath":"/TinyJson",                                                                                                "userName":"username1",                                                                                                "password":"password1"                                                                                                },                                                                                                "stepName":"step1",                                                                                                "adminUserName":"admin_test",                                                                                                "adminPassword":"admin_pass",                                                                                                "applicationUserName":"app_test",                                                                                                "applicationPassword":"app_pass"                                                                                }                                                                ]                                                }                                ]                },                "testInfo":                {              "testEnv":                                [                                                {                                                                "envName":"string",                                                                "envFlag":"on",                                                                "testSteps":                                                                                [                                                                                                {"runScript":{},                                                                                                "test":                                                                                                                {"testCategory":"functional",                                                                                                                "testTypeName":"selenium",                                                                                                                "projectName":"JPetStore_selenium",                                                                                                                "frameWork":"jUnit",                                                                                                                "testCase":"Fish.Fish_test"                                                                                                                },                                                                                                                "stepName":"step1"                                                                                                },                                                                                                {"runScript":{},                                                                                                "test":                                                                                                                {"testCategory":"service",                                                                                                                "testTypeName":"soapUI",                                                                                                                "projectName":"icart",                                                                                                                "testSuitName":"icart TestSuite1",                                                                                                                "projectLocation":"/store-1/icart.xml"                                                                                                                },                                                                                                "stepName":"step2"                                                                                                }                                                                                ]                                                }                                ]                }}/$
  def dataObj = new IDPJob( new JsonSlurper().parseText( jsonData ) )
  steps{
	TGMavenPOMEditor.invokeTool(delegate, dataObj,0, 'clean compile install')
  }
}

